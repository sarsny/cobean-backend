const axios = require('axios');

// æµ‹è¯•é‡æ„åçš„å·¥ä½œæµæ¥å£
async function testRefactoredWorkflow() {
  const baseURL = 'http://localhost:3000';
  const satToken = 'sat_X1n9dwCN24G3FKkKBwbEqEpL6pAOOCWbx24lOrRxeAdFvBtZEC7DY5qs7DNBlXyL';
  
  console.log('=== æµ‹è¯•é‡æ„åçš„å·¥ä½œæµæ¥å£ ===\n');

  try {
    // æµ‹è¯•1: ä½¿ç”¨ç®€åŒ–çš„è¾“å…¥å‚æ•°ï¼ˆåªéœ€ thoughtId å’Œ userIdï¼‰
    console.log('æµ‹è¯•1: ç®€åŒ–è¾“å…¥å‚æ•°æµ‹è¯•');
    const response1 = await axios.post(`${baseURL}/api/v1/workflow/trigger`, {
      thoughtId: '9be12eec-97a9-4cf0-8f16-c2badee5a442',
      userId: 'X1n9dwCN-24G3-FKkK-BwbE-qEpL6pAOOCWb'
    }, {
      headers: {
        'Authorization': `Bearer ${satToken}`,
        'Content-Type': 'application/json'
      }
    });

    console.log('å“åº”çŠ¶æ€:', response1.status);
    console.log('å“åº”æ•°æ®:', JSON.stringify(response1.data, null, 2));
    console.log('âœ… ç®€åŒ–è¾“å…¥å‚æ•°æµ‹è¯•æˆåŠŸ\n');

    // æµ‹è¯•2: éªŒè¯æ•°æ®è·å–é€»è¾‘
    console.log('æµ‹è¯•2: éªŒè¯æ•°æ®è·å–é€»è¾‘');
    if (response1.data.success) {
      const { thoughtId, userId, workflowResult } = response1.data.data;
      
      console.log('è¿”å›çš„ thoughtId:', thoughtId);
      console.log('è¿”å›çš„ userId:', userId);
      console.log('å·¥ä½œæµç»“æœç±»å‹:', typeof workflowResult);
      console.log('å·¥ä½œæµç»“æœåŒ…å« actions:', workflowResult && workflowResult.actions ? 'æ˜¯' : 'å¦');
      console.log('å·¥ä½œæµç»“æœåŒ…å« chats:', workflowResult && workflowResult.chats ? 'æ˜¯' : 'å¦');
      
      console.log('âœ… æ•°æ®è·å–é€»è¾‘éªŒè¯æˆåŠŸ\n');
    }

    // æµ‹è¯•3: é”™è¯¯å¤„ç†æµ‹è¯•
    console.log('æµ‹è¯•3: é”™è¯¯å¤„ç†æµ‹è¯•');
    try {
      const response3 = await axios.post(`${baseURL}/api/v1/workflow/trigger`, {
        thoughtId: 'invalid_id',
        userId: 'invalid_user'
      }, {
        headers: {
          'Authorization': `Bearer ${satToken}`,
          'Content-Type': 'application/json'
        }
      });
      console.log('âŒ é”™è¯¯å¤„ç†æµ‹è¯•å¤±è´¥ - åº”è¯¥è¿”å›é”™è¯¯');
    } catch (error) {
      console.log('é”™è¯¯å“åº”çŠ¶æ€:', error.response?.status);
      console.log('é”™è¯¯å“åº”æ•°æ®:', JSON.stringify(error.response?.data, null, 2));
      console.log('âœ… é”™è¯¯å¤„ç†æµ‹è¯•æˆåŠŸ\n');
    }

    // æµ‹è¯•4: ç¼ºå°‘å‚æ•°æµ‹è¯•
    console.log('æµ‹è¯•4: ç¼ºå°‘å‚æ•°æµ‹è¯•');
    try {
      const response4 = await axios.post(`${baseURL}/api/v1/workflow/trigger`, {
        thoughtId: '9be12eec-97a9-4cf0-8f16-c2badee5a442'
        // ç¼ºå°‘ userId
      }, {
        headers: {
          'Authorization': `Bearer ${satToken}`,
          'Content-Type': 'application/json'
        }
      });
      console.log('âŒ ç¼ºå°‘å‚æ•°æµ‹è¯•å¤±è´¥ - åº”è¯¥è¿”å›é”™è¯¯');
    } catch (error) {
      console.log('é”™è¯¯å“åº”çŠ¶æ€:', error.response?.status);
      console.log('é”™è¯¯å“åº”æ•°æ®:', JSON.stringify(error.response?.data, null, 2));
      console.log('âœ… ç¼ºå°‘å‚æ•°æµ‹è¯•æˆåŠŸ\n');
    }

    console.log('ğŸ‰ æ‰€æœ‰æµ‹è¯•å®Œæˆï¼é‡æ„åçš„å·¥ä½œæµæ¥å£å·¥ä½œæ­£å¸¸');

  } catch (error) {
    console.error('æµ‹è¯•å¤±è´¥:', error.response?.data || error.message);
    console.error('çŠ¶æ€ç :', error.response?.status);
  }
}

testRefactoredWorkflow();